---
title: "Comparing the Dutch and Egyptian Client RTT's of the UK ISP's that Served Egypt in January of 2011"
author: "Kinga"
date: "Thursday, April 16, 2015"
output: word_document
---
###Finding Egypt's ISP's during January, 2011

 I acquired the January 2011 Egypt data set from Google BigQuery as described in the
"Kinga Farkas Initial Contribution" write up.  
I read in the .csv file into R and kept only the relevant columns using the "dataConverter" function (see https://github.com/lilbludot/OutreachyProject).


```{r}
setwd("~/M_LabProject")
source("dataConverterFunction.R")
dfJan <- read.csv("Egypt2011JanRTTComplete.csv", colClasses="character") 
mainJanDF <- dataConverter(dfJan)
```

Given the whittled down data frame "mainJanDF", I created and printed a list of the 
unique IP addressess of the servers grouped by country, using the function "uniqueServerFinder".

```{r}
uniqueServerFinder <- function(mainDF){
        library(dplyr)
        mainDF$date <- as.character(mainDF$date) 
        serverCountries <- unique(mainDF$serverCountry)
        serverCountries
        serverListPerCountry <- list()
        for (i in serverCountries){
            dummy <- filter(mainDF, serverCountry == i)
            x <- unique(dummy$serverIP)
            serverListPerCountry[[i]]<-x
            print(i)
            print(x)
        
        }
       return(serverListPerCountry) 
}

JanServerList <- uniqueServerFinder(mainJanDF)

```


###Getting the Egyptian and Dutch Clients' Data for the UK servers during January, 2011


At some earlier point, while I plotted the locations of the Egyptian ISP's, I noticed that quite a bit of Egypt's traffic went through the ISP located in the UK.  Since I did not have the time to look at each one of Egypt's ISP's, I ended up selecting the UK one, especially after I realized that the very same ISP also had the Netherlands for a client. 
So, I took the six IP addressess of the UK servers and I queried  Google BigQuery's m-lab data set:

SELECT *, connection_spec.client_geolocation.continent_code, connection_spec.client_geolocation.country_name,
connection_spec.client_geolocation.city, 
connection_spec.server_geolocation.continent_code, connection_spec.server_geolocation.country_name, connection_spec.server_geolocation.city

FROM [measurement-lab:m_lab.2011_02] 
WHERE (connection_spec.server_ip == '217.163.1.101' OR
     connection_spec.server_ip == '213.244.128.164' OR
     connection_spec.server_ip == '217.163.1.75' OR
connection_spec.server_ip == '213.244.128.152' OR
connection_spec.server_ip == '213.244.128.139' OR
connection_spec.server_ip == '217.163.1.88') 
   AND (connection_spec.client_geolocation.country_name == "Egypt" 
   OR connection_spec.client_geolocation.country_name == "Netherlands")
   AND IS_EXPLICITLY_DEFINED(web100_log_entry.connection_spec.remote_ip)
   AND IS_EXPLICITLY_DEFINED(web100_log_entry.connection_spec.local_ip)
   AND IS_EXPLICITLY_DEFINED(web100_log_entry.snap.HCThruOctetsAcked)
   AND IS_EXPLICITLY_DEFINED(web100_log_entry.snap.SndLimTimeRwin)
   AND IS_EXPLICITLY_DEFINED(web100_log_entry.snap.SndLimTimeCwnd)
   AND IS_EXPLICITLY_DEFINED(web100_log_entry.snap.SndLimTimeSnd)
   AND IS_EXPLICITLY_DEFINED(project)
   AND project = 0
   AND IS_EXPLICITLY_DEFINED(connection_spec.data_direction)
   AND connection_spec.data_direction = 1
   AND IS_EXPLICITLY_DEFINED(web100_log_entry.is_last_entry)
   AND web100_log_entry.is_last_entry = True
   AND web100_log_entry.snap.HCThruOctetsAcked >= 8192
   AND (web100_log_entry.snap.SndLimTimeRwin + 
        web100_log_entry.snap.SndLimTimeCwnd + 
        web100_log_entry.snap.SndLimTimeSnd) >= 9000000
   AND (web100_log_entry.snap.SndLimTimeRwin + 
        web100_log_entry.snap.SndLimTimeCwnd +  
        web100_log_entry.snap.SndLimTimeSnd) < 3600000000
   AND IS_EXPLICITLY_DEFINED(web100_log_entry.snap.MinRTT)
   AND IS_EXPLICITLY_DEFINED(web100_log_entry.snap.CountRTT)
   AND web100_log_entry.snap.CountRTT > 0
   AND (web100_log_entry.snap.State == 1
        OR (web100_log_entry.snap.State >= 5
            AND web100_log_entry.snap.State <= 11));
            
This way I got all the Dutch and Egyptian client data for the six UK servers for the January, 2011 time
period.  
I then downloaded and cleaned up the data a bit:

```{r}
EgyptNethJan2011DF<-read.csv("UKServers.csv" )
Jan2011DF <- dataConverter(EgyptNethJan2011DF)
Jan2011DF$date <- as.character(Jan2011DF$date)
head(Jan2011DF)

```

I separated the data frame into two parts: one containing all the Egyptian client data, the other the Dutch data.  


```{r}
library(dplyr)
EgyptJan2011DF <- filter(Jan2011DF, clientCountry=="Egypt")
NethJan2011DF <-filter(Jan2011DF, clientCountry =="Netherlands")

```


###Comparing the Dutch and Egyptian Data Sets

First of all, how did the size of the data sets compare?

Well,

```{r}
nrow(EgyptJan2011DF)
nrow(NethJan2011DF)

```

The number of tests run in Egypt (`nrow(EgyptJan2011DF)`) is but a fraction of the 
tests run in the Netherlands (`nrow(NethJan2011DF`)).  
I had to be careful when comparing values other than averages, median and IQR's, specifically
it was not fair to plot the outliers of the Dutch data set side by side the Egyptian data set.


####Boxplots

I created side by side boxplots:

```{r}
boxplot(EgyptJan2011DF$RTT , NethJan2011DF$RTT,  main="RTT's for the UK Servers of Egypt during January 2011", xlab="", ylab="RTT", names=c("Egypt","Netherlands"),col=c("thistle","wheat"), outline=FALSE)

```

without the outliers.

Then I plotted the individual boxplots, now with the outliers:

```{r}
boxplot(EgyptJan2011DF$RTT , main="Egypt's RTT for its UK Servers in January 2011", 
        xlab="Index", ylab="RTT", col="thistle")

boxplot(NethJan2011DF$RTT , main="Netherlands's RTT for the UK Servers in January 2011", 
        xlab="Index", ylab="RTT", col="wheat")
```


Finally, in order to get a bit deeper understanding of the data I calculated the averages and medians of the RTT's for both Egypt and the Netherlands:

```{r}
median(EgyptJan2011DF$RTT)
mean(EgyptJan2011DF$RTT)
median(NethJan2011DF$RTT)
mean(NethJan2011DF$RTT)
```

The Egyptian distribution is more right skewed than the Dutch one. 
And, more obviously,  the average Egyptian RTT  for the UK servers is more than ten times larger 
than the average Dutch RTT.   

###Conclusions

The fact that the mean Egyptian RTT is `265/24` times larger than the average Dutch RTT  - as clients of the same British ISP - leads me to suspect that the slow internet speeds in Egypt (evidenced by the large Egyptian RTT's) are not due to the British ISP's poor performance.  
However, further and more precises analyses must be done in order to be certain. 
